<!DOCTYPE html>
<html>
<head>
    <title>CrossWorkspaceReleaseBurndown</title>

    <script type="text/javascript" src="/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define('CrossWorkspaceReleaseBurndownApp', {
    extend: 'Rally.app.App',
    componentCls: 'app',

    requires: [
        'CrossWorkspaceReleaseBurndownCalculator'
    ],

    launch: function() {
        this.add({
            xtype: 'rallychart',
            storeType: 'Rally.data.lookback.SnapshotStore',
            storeConfig: this._getStoreConfig(),
            calculatorType: 'CrossWorkspaceReleaseBurndownCalculator',
            chartConfig: this._getChartConfig()
        });
    },

    _getStoreConfig: function() {
        return {
            find: {
                _ItemHierarchy: this.getDefaultWorkspace(),
                _TypeHierarchy: 'HierarchicalRequirement',
                Children: null
            },
            fetch: ['AcceptedDate'],
            hydrate: ['AcceptedDate'],
            sort: {
                _ValidFrom: 1
            },
            context: this.getContext().getDataContext(),
            limit: Infinity
        };
    },

    _getChartConfig: function() {
        return {
            chart: {
                defaultSeriesType: 'area',
                zoomType: 'xy'
            },
            title: {
                text: 'Cross Workspace Release Burndown'
            },
            xAxis: {
                categories: [],
                tickmarkPlacement: 'on',
                tickInterval: 5,
                title: {
                    text: 'Date',
                    margin: 10
                }
            },
            yAxis: [
                {
                    title: {
                        text: 'Accepted (points)'
                    }
                }
            ],
            tooltip: {
                formatter: function() {
                    return '' + this.x + '<br />' + this.series.name + ': ' + this.y;
                }
            },
            plotOptions: {
                series: {
                    marker: {
                        enabled: false,
                        states: {
                            hover: {
                                enabled: true
                            }
                        }
                    },
                    groupPadding: 0.01
                },
                column: {
                    stacking: null,
                    shadow: false
                }
            }
        };
    },

    getDefaultWorkspace: function() {
        return 41529001;
    }
});

                Ext.define('CrossWorkspaceReleaseBurndownCalculator', {
    extend: 'Rally.data.lookback.calculator.TimeSeriesCalculator',

    constructor: function(config) {
        this.initConfig(config);
        this.callParent(arguments);
    },

    getMetrics: function () {
        return [
            {
                "field": "AcceptedDate",
                "as": "Accepted Points",
                "display": "line",
                "f": "sum"
            }
            //{
            //    "field": "PlanEstimate",
            //    "as": "Completed",
            //    "f": "filteredSum",
            //    "filterField": "ScheduleState",
            //    "filterValues": ["Accepted", "Released"],
            //    "display": "column"
            //}
        ];
    }
});


            Rally.launchApp('CrossWorkspaceReleaseBurndownApp', {
                name:"CrossWorkspaceReleaseBurndown",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
  /* Add app styles here */
}

    </style>
</head>
<body>
</body>
</html>
