<!DOCTYPE html>
<html>
<head>
    <title>CrossWorkspaceReleaseBurndown</title>

    <script type="text/javascript" src="/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CrossWorkspaceReleaseBurndownApp",{extend:"Rally.app.App",componentCls:"app",requires:["Deft.Deferred","CrossWorkspaceReleaseBurndownCalculator"],launch:function(){Deft.Chain.pipeline([this.getWorkspaceCollection,this.createReleaseComboBoxes],this)},getWorkspaceCollection:function(){var deferred=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",{model:"Subscription",fetch:!0,autoLoad:!0,listeners:{load:function(store,data){var subscription=data[0];subscription.getCollection("Workspaces").load({fetch:["ObjectID","Name","State"],callback:function(records){var openWorkspaces=_.filter(records,function(record){return"Closed"!==record.get("State")});deferred.resolve(openWorkspaces)}})}}}),deferred.promise},createReleaseComboBoxes:function(workspaces){var me=this;return Deft.Promise.all(_.map(workspaces,function(workspace){return function(){var deferred=Ext.create("Deft.Deferred");return me.add({xtype:"rallyreleasecombobox",fieldLabel:workspace.get("Name"),storeConfig:{context:{workspace:Rally.util.Ref.getRelativeUri(workspace),project:null,projectScopeUp:!1,projectScopeDown:!1}},listeners:{ready:function(){deferred.resolve()}},scope:me}),deferred.promise}()}))}});
                Ext.define("CrossWorkspaceReleaseBurndownCalculator",{extend:"Rally.data.lookback.calculator.TimeSeriesCalculator",constructor:function(config){this.initConfig(config),this.callParent(arguments)},getMetrics:function(){return[{field:"AcceptedDate",as:"Accepted Points",display:"line",f:"sum"}]}});

            Rally.launchApp('CrossWorkspaceReleaseBurndownApp', {
                name:"CrossWorkspaceReleaseBurndown",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
