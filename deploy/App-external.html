<!DOCTYPE html>
<html>
<head>
    <title>CrossWorkspaceReleaseBurndown</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CrossWorkspaceReleaseBurndownApp",{extend:"Rally.app.App",componentCls:"app",requires:["Deft.Deferred","Ext.form.field.ComboBox","Rally.data.wsapi.Store"],launch:function(){Deft.Chain.pipeline([this.createFilteredReleaseStore,this.createFilteredCombobox],this)},createFilteredReleaseStore:function(){var deferred=Ext.create("Deft.Deferred"),releases=[],me=this;return Ext.create("Rally.data.wsapi.Store",{model:"Release",autoLoad:!0,context:{workspace:null,project:null},limit:1/0,listeners:{load:function(store,data){_.map(data,function(release){var rData=release.data,likeRelease=me._isLikeReleaseInList(releases,rData.Name);likeRelease?(likeRelease.ObjectID.push(rData.ObjectID),_.isEqual(likeRelease.Workspace,rData.Workspace)&&likeRelease.Workspace.push(rData.Workspace)):releases.push({Name:rData.Name,ObjectID:[rData.ObjectID],Workspace:[rData.Workspace],ReleaseStartDate:rData.ReleaseStartDate,ReleaseDate:rData.ReleaseDate})}),releases=_.sortBy(releases,"Name"),console.log(releases.length),deferred.resolve(releases)}}}),deferred.promise},createFilteredCombobox:function(filteredReleases){var combobox=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"Choose Release",store:Ext.create("Ext.data.Store",{data:filteredReleases,fields:["Name","ObjectID"]}),displayField:"Name",valueField:"ObjectId",width:600,listeners:{select:function(combo,record){var data=record[0].getData()}}});this.add(combobox)},_isLikeReleaseInList:function(releases,releaseName){return _.find(releases,function(release){return release.Name===releaseName})}});
                Ext.define("CrossWorkspaceReleaseBurndownCalculator",{extend:"Rally.data.lookback.calculator.TimeSeriesCalculator",constructor:function(config){this.initConfig(config),this.callParent(arguments)},getMetrics:function(){return[{field:"PlanEstimate",as:"Derp Points",display:"line",f:"sum"}]}});

            Rally.launchApp('CrossWorkspaceReleaseBurndownApp', {
                name:"CrossWorkspaceReleaseBurndown",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
